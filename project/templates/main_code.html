<div class="stage-tabs">
  <button class="stage-tab active" data-stage="pre">ì „ì²˜ë¦¬</button>
  <button class="stage-tab" data-stage="model">ëª¨ë¸ ì„¤ê³„</button>
  <button class="stage-tab" data-stage="train">í•™ìŠµ</button>
  <button class="stage-tab" data-stage="eval">í‰ê°€</button>
</div>

<!-- Preprocessing ì½”ë“œ -->
<div class="stage-pane" id="pane-code-pre">
  <div style="display:flex; gap:.5rem; margin-bottom:.5rem;">
    <!-- ğŸ”¹ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½ (JavaScriptë¡œ ì²˜ë¦¬) -->
    <button class="btn" onclick="downloadCode('pre')">preprocessing.py ë‹¤ìš´ë¡œë“œ</button>
    <button class="btn btn-run" data-run="pre">ì´ ë‹¨ê³„ ì‹¤í–‰</button>
    <button class="btn" onclick="document.getElementById('tab-log').click()">ë¡œê·¸ ë³´ê¸°</button>
  </div>
  <pre class="code" id="code-pre">{% if snippet_pre %}{{ snippet_pre | e }}{% else %}# ì „ì²˜ë¦¬ ì½”ë“œê°€ ìƒì„±ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.{% endif %}</pre>
</div>

<!-- ModelDesign ì½”ë“œ -->
<div class="stage-pane" id="pane-code-model" hidden>
  <div style="display:flex; gap:.5rem; margin-bottom:.5rem;">
    <button class="btn" onclick="downloadCode('model')">model.py ë‹¤ìš´ë¡œë“œ</button>
    <button class="btn btn-run" data-run="model">ì´ ë‹¨ê³„ ì‹¤í–‰</button>
    <button class="btn" onclick="document.getElementById('tab-log').click()">ë¡œê·¸ ë³´ê¸°</button>
  </div>
  <pre class="code" id="code-model">{% if snippet_model %}{{ snippet_model | e }}{% else %}# ëª¨ë¸ ì„¤ê³„ ì½”ë“œê°€ ìƒì„±ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.{% endif %}</pre>
</div>

<!-- Training ì½”ë“œ -->
<div class="stage-pane" id="pane-code-train" hidden>
  <div style="display:flex; gap:.5rem; margin-bottom:.5rem;">
    <button class="btn" onclick="downloadCode('train')">training.py ë‹¤ìš´ë¡œë“œ</button>
    <button class="btn btn-run" data-run="train">ì´ ë‹¨ê³„ ì‹¤í–‰</button>
    <button class="btn" onclick="document.getElementById('tab-log').click()">ë¡œê·¸ ë³´ê¸°</button>
  </div>
  <pre class="code" id="code-train">{% if snippet_train %}{{ snippet_train | e }}{% else %}# í•™ìŠµ ì½”ë“œê°€ ìƒì„±ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.{% endif %}</pre>
</div>

<!-- Evaluation ì½”ë“œ -->
<div class="stage-pane" id="pane-code-eval" hidden>
  <div style="display:flex; gap:.5rem; margin-bottom:.5rem;">
    <button class="btn" onclick="downloadCode('eval')">evaluation.py ë‹¤ìš´ë¡œë“œ</button>
    <button class="btn btn-run" data-run="eval">ì´ ë‹¨ê³„ ì‹¤í–‰</button>
    <button class="btn" onclick="document.getElementById('tab-log').click()">ë¡œê·¸ ë³´ê¸°</button>
  </div>
  <pre class="code" id="code-eval">{% if snippet_eval %}{{ snippet_eval | e }}{% else %}# í‰ê°€ ì½”ë“œê°€ ìƒì„±ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.{% endif %}</pre>
</div>

<!-- ğŸ”¹ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ ì¶”ê°€ -->
<script>
function downloadCode(stage) {
  // ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
  const userIdInput = document.getElementById('user-id-input');
  const userId = userIdInput ? userIdInput.value.trim() || 'anonymous' : 'anonymous';
  
  if (userId === 'anonymous') {
    alert('ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
    if (userIdInput) userIdInput.focus();
    return;
  }
  
  // ì‚¬ìš©ì IDë¥¼ í¬í•¨í•œ ë‹¤ìš´ë¡œë“œ URL
  const downloadUrl = `/download/${stage}?user_id=${encodeURIComponent(userId)}`;
  
  // ìƒˆ ì°½ì—ì„œ ë‹¤ìš´ë¡œë“œ
  window.open(downloadUrl, '_blank');
}

// ì „ì²´ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ë„ ì¶”ê°€
function downloadAll() {
  const userIdInput = document.getElementById('user-id-input');
  const userId = userIdInput ? userIdInput.value.trim() || 'anonymous' : 'anonymous';
  
  if (userId === 'anonymous') {
    alert('ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
    if (userIdInput) userIdInput.focus();
    return;
  }
  
  const downloadUrl = `/download/all?user_id=${encodeURIComponent(userId)}`;
  window.open(downloadUrl, '_blank');
}
</script>